/**
 * Eventfeed.js - Google Calender Event Feed
 * v1.0.0 - MIT License
 * https://sethmcleod.github.io/eventfeed.js/ - git://github.com/sethmcleod/eventfeed.js.git
 * by Seth Mcleod - @sthmcleod
 */

!function(){"use strict";var e,t;e=function(){function e(e,n){var o,r;if(this.options={target:"eventfeed",orderBy:"none",pastEvents:!1,abbreviate:!1,links:!1,mock:!1},"object"==typeof e)for(o in e)r=e[o],this.options[o]=r;this.context=null!=n?n:this,this.unique=t()}function t(){var e;return e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},""+e()+e()+e()+e()}function n(e,t){var n=new Date(e),o=["January","February","March","April","May","June","July","August","September","October","November","December"],r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return t===!0?r[n.getMonth()]:o[n.getMonth()]}function o(e){var t=new Date(e);return t.getDate()+s(t.getDate())}function r(e){var t=new Date(e);return t.timeNow()}function s(e){if(e>3&&21>e)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}return e.prototype.run=function(t){var n,o,r;if("string"!=typeof this.options.calendarId)throw new Error("Missing calendarId.");return null!=this.options.before&&"function"==typeof this.options.before&&this.options.before.call(this),"undefined"!=typeof document&&null!==document&&(r=document.createElement("script"),r.id="eventfeed-fetcher",r.src=t||this.buildUrl(),n=document.getElementsByTagName("head"),n[0].appendChild(r),o="eventfeedCache"+this.unique,window[o]=new e(this.options,this),window[o].unique=this.unique),!0},e.prototype.buildUrl=function(){var e,t,n,o,r;if(e="https://www.googleapis.com/calendar/v3/calendars/",t="&fields=description,items(created,description,end,hangoutLink,htmlLink,id,location,start,status,summary,updated)",n="&key=AIzaSyBl3FauupFzkP3F4BYqL47_keO-PSmrTOQ",o=""+e+this.options.calendarId+"/events?",r=(new Date).toISOString(),null!=this.options.maxResults){if("number"!=typeof this.options.maxResults)throw new Error("The maxResults option must be a number.");o+="&maxResults="+this.options.maxResults}if(null!=this.options.singleEvents){if("boolean"!=typeof this.options.singleEvents)throw new Error("The singleEvents option must be a boolean.");o+="&singleEvents="+this.options.singleEvents}if(null!=this.options.showDeleted){if("boolean"!=typeof this.options.showDeleted)throw new Error("The showDeleted option must be a boolean.");o+="&showDeleted="+this.options.showDeleted}if("boolean"!=typeof this.options.pastEvents)throw new Error("The pastEvents option must be a boolean.");switch(this.options.pastEvents===!1&&(o+="&timeMin="+r),this.options.orderBy){case"none":break;case"startTime":if(this.options.singleEvents!==!0)throw new Error("The singleEvents option must be true to order by startTime.");o+="&orderBy=startTime";break;case"updated":o+="&orderBy=updated";break;default:throw new Error("Invalid option for orderBy: '"+this.options.orderBy+"'.")}return o+=t,o+=n,console.log("url: "+o),o+="&callback=eventfeedCache"+this.unique+".parseData"},e.prototype.parseData=function(e){var t,s,i,a,l,d,u,p,c,h,m,f,g,w,v,y;if("object"!=typeof e){if(null!=this.options.error&&"function"==typeof this.options.error)return this.options.error.call(this,"Invalid JSON data."),!1;throw new Error("Invalid JSON response.")}if(e.error){if(null!=this.options.error&&"function"==typeof this.options.error)return this.options.error.call(this,e.error.code+" "+e.error.message),!1;throw new Error("Error from Google: "+e.error.code+" "+e.error.message)}if(0===e.items.length){if(null!=this.options.error&&"function"==typeof this.options.error)return this.options.error.call(this,"No events were returned from Google."),!1;throw new Error("No events were returned from Google.")}if(null!=this.options.success&&"function"==typeof this.options.success&&this.options.success.call(this,e),"undefined"!=typeof document&&null!==document&&this.options.mock===!1){i=document.createDocumentFragment();for(var E=0;E<e.items.length;E++)l=e.items[E],console.log(l),a=document.createElement("div"),a.className="event",a.id=l.id,u=document.createElement("div"),u.className="date",a.appendChild(u),h=document.createElement("div"),h.className="info",a.appendChild(h),w=document.createElement("div"),w.className="time",a.appendChild(w),p=document.createElement("span"),p.className="month",p.innerHTML=n(l.start.dateTime||l.start.date,this.options.abbreviate),u.appendChild(p),c=document.createElement("span"),c.className="day",c.innerHTML=o(l.start.dateTime||l.start.date,this.options.abbreviate),u.appendChild(c),l.summary&&(m=document.createElement("span"),m.className="title",m.innerHTML=l.summary,h.appendChild(m)),l.description&&(f=document.createElement("span"),f.className="description",f.innerHTML=l.description,h.appendChild(f)),l.location&&(g=document.createElement("span"),g.className="location",g.innerHTML=l.location,h.appendChild(g)),l.start.date&&l.end.date?(v=document.createElement("span"),v.className="start",v.innerHTML="All day event",w.appendChild(v)):(v=document.createElement("span"),v.className="start",v.innerHTML="From: "+r(l.start.dateTime||l.start.date),w.appendChild(v),y=document.createElement("span"),y.className="end",y.innerHTML="To: "+r(l.end.dateTime||l.end.date),w.appendChild(y)),this.options.links===!0?(d=document.createElement("a"),d.href=l.htmlLink,d.appendChild(a),i.appendChild(d),console.log(d)):(i.appendChild(a),console.log(a));document.getElementById(this.options.target).appendChild(i),t=document.getElementsByTagName("head")[0],t.removeChild(document.getElementById("eventfeed-fetcher")),s="eventfeedCache"+this.unique,window[s]=void 0;try{delete window[s]}catch(b){console.log("Cached data could not be deleted.")}null!=this.options.after&&"function"==typeof this.options.after&&this.options.after.call(this,e)}return!0},Date.prototype.timeNow=function(){return(this.getHours()<10?"0":"")+(this.getHours()>12?this.getHours()-12:this.getHours())+":"+(this.getMinutes()<10?"0":"")+this.getMinutes()+(this.getHours()>12?"pm":"am")},e}(),t="undefined"!=typeof exports&&null!==exports?exports:window,t.Eventfeed=e}();